# solidityå¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£å°±ä¸€ä¸ªç›®æ ‡ï¼šç§’æ‡‚æµç¨‹ï¼Œå¿«é€Ÿä¸Šæ‰‹ï¼ğŸ˜¼

å®˜æ–¹æ–‡æ¡£ï¼š[ä¸­æ–‡](https://docs.soliditylang.org/zh/v0.8.20/)ï¼Œ[è‹±æ–‡](https://docs.soliditylang.org/en/v0.8.23/)ï¼ˆä¸­æ–‡çš„æ˜¾ç¤ºé å·¦ä¾§ï¼Œå³è¾¹æ˜¯ç©ºçš„ğŸ˜…ï¼‰



## åˆçº¦éƒ¨ç½²è°ƒç”¨æµç¨‹

> é¦–å…ˆä¸Šæ¥åˆ«ç®¡é‚£ä¹ˆå¤šï¼Œè¿è¡Œä¸ªHelloWorldï¼

1. é€‰æ‹©ç”¨æˆ·éƒ¨ç½²åˆçº¦
2. è°ƒç”¨åˆçº¦æ–¹æ³•

> æ¯”èµ›çš„å­˜å‚¨æ˜¯åŸºäºFisco Bcos 2.0æä¾›çš„[Table CRUD](https://fisco-bcos-documentation.readthedocs.io/zh-cn/latest/docs/articles/3_features/33_storage/crud_guidance.html)å®ç°æ•°æ®å­˜å‚¨çš„ï¼Œæ‰€ä»¥æ•´ä¸ªä½¿ç”¨æµç¨‹å‚è€ƒå…³ç³»å‹æ•°æ®åº“ï¼Œä¾‹å¦‚mysqlç­‰ã€‚

### éƒ¨ç½²

ä½¿ç”¨æŒ‡å®šçš„ç”¨æˆ·è°ƒç”¨åˆçº¦æ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–çŠ¶æ€å’Œæ•°æ®ã€‚

> çœŸå®ä¸šåŠ¡ä¸­ï¼Œéœ€è¦ç”¨è¯¥è´¦æˆ·æ”¯ä»˜è´¹ç”¨ï¼Œå¹¶ç»™äºˆè¯¥ç”¨æˆ·ç®¡ç†å‘˜æƒé™ã€‚
>
> æ‰€ä»¥éƒ¨ç½²é€šè¿‡[äº¤æ˜“](#äº¤æ˜“)å®ç°çš„ã€‚ä¸è¿‡æˆ‘ä»¬çš„æ˜¯å…è´¹çš„ã€‚

### è°ƒç”¨

æ–¹å¼å¾ˆå¤šï¼šæ§åˆ¶å°å‘½ä»¤è°ƒç”¨ï¼Œæµè§ˆå™¨å›¾å½¢åŒ–ç•Œé¢è°ƒç”¨ï¼Œhttpæ¥å£è°ƒç”¨ï¼ˆåç«¯æˆ–è€…ä½¿ç”¨postmanç­‰æµ‹è¯•å·¥å…·ï¼‰ã€‚

å¦‚æœå¤šä¸€ä¸ª `account` çš„å‚æ•°å‡ºæ¥ï¼Œæ˜¯è¯´æ˜è¯¥æ–¹æ³•éœ€è¦ä½ æŒ‡å®šè°ƒç”¨è¯¥å‡½æ•°çš„ç”¨æˆ·ã€‚

> æ³¨æ„ï¼šè¿™ä¸ªå‚æ•°ä¸ä½ åœ¨ä½¿ç”¨`get`è¿™ç±»æ–¹æ³•æ—¶ä¼ é€’çš„ä»€ä¹ˆ `userAddr` ä¸åŒã€‚ä¸»è¦åŒºåˆ«æ˜¯åœ¨å‡½æ•°å†…è·å–çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œaccountæ˜¯é€šè¿‡å…¨å±€å˜é‡ `msg.sender` æˆ–è€… `tx.origin` è·å¾—ã€‚è€Œ `userAddr`ï¼Œæ˜¯é€šè¿‡å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­å®šä¹‰çš„å‚æ•°è¿›è¡Œæ¥æ”¶çš„ã€‚åœ¨è¯·æ±‚ä½“ä¸­ä¹Ÿå¯ä»¥å‘ç°ï¼Œ`account` æ˜¯é€šè¿‡ `user` å‘é€çš„ï¼Œè€Œ `userAddr`è¿™ç±»å‚æ•°æ˜¯åœ¨ `funcParam` ä¸­çš„ã€‚
>
> 

ä¼šå‡ºç°è¯¥å‚æ•°æ˜¯å› ä¸ºå‡½æ•°ç­¾åä¸­æ²¡æœ‰ä½¿ç”¨ `view` æˆ–è€… `pure` ä¿®é¥°ç¬¦ï¼Œè¿™è¯´æ˜è¯¥æ–¹æ³•ä¸ä¼š[ä¿®æ”¹çŠ¶æ€](https://docs.soliditylang.org/zh/v0.8.20/contracts.html#view)ï¼Œä¸ºäº†ä¿è¯**å®‰å…¨æ€§**ï¼Œå¿…é¡»æ‰§è¡Œäº¤æ˜“ï¼ˆè°ƒç”¨å‡½æ•°ï¼‰çš„ç”¨æˆ·ã€‚

> æˆ‘çŒœçš„ğŸ«£ï¼Œå…¶å®ä¹Ÿå·®ä¸å¤šï¼Œä¸æŒ‡å®šè¿™ä¸ªaccountå°±æ²¡æ³•åšç”¨æˆ·æƒé™æ ¡éªŒå’Œè®°å½•å‘èµ·äº¤æ˜“çš„ç”¨æˆ·äº†ï¼Œè¿™ä¸€ç‚¹å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰è¯´åˆ°ã€‚



## å¼€å‘æµç¨‹

1. äº†è§£ä¸šåŠ¡æµç¨‹ï¼ˆé€»è¾‘ï¼‰
2. æ“ä½œä¸šåŠ¡ä¸­çš„æ•°æ®æµï¼ˆcrudï¼‰

ç¬¬ä¸€æ­¥ï¼Œäº†è§£ä¸šåŠ¡æµç¨‹ï¼Œè¿™ä¸ªéœ€è¦ç»“åˆå®é™…çš„ä¸šåŠ¡ã€‚å¯ä»¥åœ¨é¢˜ç›®ä¸­ä¸»é”®ç†Ÿæ‚‰ã€‚

ç¬¬äºŒéƒ¨ï¼ŒCRUDã€‚æåˆ°CRUDï¼Œé‚£å°±ä¸å¾—ä¸ææ•°æ®çš„è¯»å†™ã€‚åœ¨`FISCO BCOS`ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§å­˜å‚¨æ•°æ®çš„æ–¹å¼ï¼š

- ç›´æ¥å˜é‡å­˜å‚¨

  ![image.png](https://img10.360buyimg.com/ddimg/jfs/t1/102903/28/44178/10678/65770a4aF2f49f330/aa935d618da9f44e.jpg)

  è¿™äº›ä¸‰ä¸ªstringå˜é‡éƒ½ä¼šæ°¸ä¹…å­˜å‚¨åœ¨åŒºå—é“¾ä¸­ã€‚

- `FISCO BCOS`æä¾›çš„`Table CRUD`APIï¼ˆå•¥æ˜¯APIï¼Ÿå°±æ˜¯ä½ æŠŠæ–‡ä»¶ä¸€å¯¼å…¥å°±èƒ½ç›´æ¥ç”¨å®ƒå†™å¥½çš„å‡½æ•°ï¼‰e.g.ï¼š![image.png](https://img13.360buyimg.com/ddimg/jfs/t1/235253/31/7693/50815/65770b09F343cf2fb/7ab91b1171e9a405.jpg)

  è¿™ä¸ªæ—¶å€™ä½ åˆè¦é—®å•¦ï¼š**Tableæ˜¯ä»€ä¹ˆä¸œè¥¿å•Šï¼Ÿ**ğŸ¤”

  Tableï¼Ÿç®€å•ç†è§£å°±æ˜¯**excel**ï¼Œé‚£ç©æ„ä¸ä¹Ÿå«åšTableï¼ˆè¡¨ï¼‰å˜›ï¼Œä¸€æ ·çš„ä¸€æ ·çš„ğŸ˜˜ã€‚

> **é¢˜å¤–è¯**ï¼šå®é™…ä¸šåŠ¡ä¸­æ•°æ®è¿˜æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ã€‚è¿™ä¸ªæ˜¯é€šè¿‡ORMå®ä½“æ˜ å°„å®ç°çš„ï¼ˆåˆ«æ…Œï¼Œå°±æ˜¯æ•°æ®åº“åº“è¡¨è®¾è®¡ï¼Œå•¥å­˜æ•°æ®åº“éƒ½ä¸€æ ·ï¼‰ã€‚ç”±æ­¤å¯è§ï¼ŒåŒºå—é“¾çš„ä¸»è¦åº”ç”¨è¿˜æ˜¯åœ¨åŠ å¯†å’Œå®‰å…¨åŒæ­¥ï¼ˆé˜²æ­¢ç¯¡æ”¹ï¼‰ä¸Šã€‚



## Table CRUD

å¦‚æœæ˜¯è¦åƒSQLé‚£æ ·è®²Tableçš„è¯ï¼Œé‚£å°±æœ‰çš„è®²äº†ã€‚ä¸è¿‡`FISCO BCOS`æä¾›çš„è¿™ä¸ªtableé‚£ä¹ˆçš„å¤æ‚ï¼Œåªæ˜¯åˆ©ç”¨é‚£ä¸ªæ¨¡å‹è¿›è¡Œæ•°æ®å­˜å‚¨ã€‚

å…·ä½“ç”¨æ³•è§[å®˜ç½‘æ–‡æ¡£](https://fisco-bcos-documentation.readthedocs.io/zh-cn/latest/docs/articles/3_features/33_storage/crud_guidance.html)

å’±webaseå¹³å°ä¸Šä¹Ÿæœ‰ä¸€äº›å‚è€ƒç”¨ä¾‹ï¼Œå»æ‰¾é‡Œé¢å¸¦`Table.sol`çš„æ–‡ä»¶å¤¹ã€‚



### æ¦‚å¿µ

ä¸»é”®ï¼šå”¯ä¸€æ ‡è¯†è¡¨ä¸­æ¯ä¸€è¡Œè®°å½•çš„ä¸€åˆ—æˆ–ä¸€ç»„åˆ—ã€‚**STOPï¼STOPï¼**è¿™æ˜¯åœ¨DBä¸­çš„æ¦‚å¿µï¼Œåœ¨`FISCO BCOS`ä¸­ï¼Œä¸»é”®åªèƒ½æœ‰ä¸€ä¸ªï¼Œä¸”ä¸å”¯ä¸€ã€‚è¯¦æƒ…è§[è¿™é‡Œ](#è¡¨è®¾è®¡)ã€‚

è®°å½•ï¼šè¡Œ

å­—æ®µï¼šåˆ—å



## äº¤æ˜“

ç”±äºåœ¨åŒºå—é“¾ä¸­æ‰€æœ‰çš„è®¡ç®—å’Œå­˜å‚¨éƒ½æ˜¯éœ€è¦æ¶ˆè€—ç‡ƒæ°”`gas`å€¼çš„ï¼ˆè¯´ç™½äº†å°±æ˜¯è®¡ç®—èµ„æºï¼‰ï¼Œæ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨ï¼Œåˆçº¦éƒ¨ç½²éƒ½æ˜¯é€šè¿‡äº¤æ˜“è¿›è¡Œçš„ã€‚ï¼ˆèŠ±é’±ä½¿ç”¨èµ„æºï¼‰



## ç›¸å…³å‚æ•°

#### contractAddress

åˆçº¦å­˜å‚¨çš„åœ°å€



#### ABI

ABI å®šä¹‰äº†åˆçº¦æ–¹æ³•çš„åç§°ã€å‚æ•°ç±»å‹ã€è¿”å›ç±»å‹å’Œäº‹ä»¶çš„ç»“æ„ã€‚



### äº‹ä»¶

> solidityä¸­çš„äº‹ä»¶ç±»ä¼¼æ—¥å¿—ã€‚
>
> ä¸€èˆ¬åœ¨æ•æ„Ÿæ“ä½œï¼ˆå¢åˆ æ”¹ï¼‰æ•°æ®çš„æ—¶å€™è§¦å‘äº‹ä»¶ã€‚



1. å®šä¹‰äº‹ä»¶

   ä½¿ç”¨eventå…³é”®å­—

   ```soli
   // åˆçº¦å®šä¹‰
   contract MyContract {
       event MyEvent(address indexed sender, uint256 value);
   
       // ...
   }
   ```

2. è§¦å‘äº‹ä»¶

   ```solidity
   // åˆçº¦å®šä¹‰
   contract MyContract {
       event MyEvent(address indexed sender, uint256 value);
   
       function doSomething() public {
           // æ‰§è¡Œæ“ä½œ
           emit MyEvent(msg.sender, 123);
       }
   }
   ```

3. ç›‘å¬äº‹ä»¶

   ç›‘å¬äº‹ä»¶ï¼šåœ¨ä½ çš„ DApp æˆ–å…¶ä»–åˆçº¦ä¸­ï¼Œä½ å¯ä»¥æ·»åŠ äº‹ä»¶ç›‘å¬å™¨æ¥æ•è·å’Œå¤„ç†è§¦å‘çš„äº‹ä»¶ã€‚åœ¨ä»¥å¤ªåŠå¼€å‘ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ Web3.js æˆ–å…¶ä»–ä»¥å¤ªåŠå®¢æˆ·ç«¯åº“æ¥ç›‘å¬äº‹ä»¶ã€‚

   ä½¿ç”¨Web3.jsç›‘å¬çš„å®ä¾‹ä»£ç ï¼š

   ```javascript
   // Web3.js ç¤ºä¾‹ä»£ç 
   const myContract = new web3.eth.Contract(abi, contractAddress);
   
   myContract.events.MyEvent()
       .on('data', (event) => {
           console.log('æ”¶åˆ°äº‹ä»¶:', event.returnValues);
           // åœ¨è¿™é‡Œå¤„ç†äº‹ä»¶
       })
       .on('error', (error) => {
           console.error('äº‹ä»¶é”™è¯¯:', error);
       });
   ```




## æ³¨æ„ç‚¹

### å˜é‡

#### Stack too deep

åˆçº¦å†…å˜é‡ä¸è¦å®šä¹‰å¤ªå¤šï¼Œå¤ªå¤šäº†ä¼šæŠ¥é”™`stack too deep`ã€‚å¦‚æœå‡ºç°æŠ¥é”™äº†ï¼Œè§£å†³æ–¹æ³•ï¼š

- ä½¿ç”¨ç»“æ„ä½“`struct`

  ![image.png](https://img10.360buyimg.com/ddimg/jfs/t1/232865/34/7417/8758/65770474F67376bda/296c1468c7fe6525.jpg)

- å°½å¯èƒ½è·³è¿‡ä¸­é—´å˜é‡   e.g.


![image.png](https://img11.360buyimg.com/ddimg/jfs/t1/235421/5/6217/13383/65702d15F7bd5c606/2a7a079376208398.jpg)



### ä¿®é¥°ç¬¦

#### memory

ä¸€äº›ç‰¹å®šçš„ç±»å‹ä¸èƒ½ä½¿ç”¨`memory`ä¿®é¥°ç¬¦ï¼Œä¸ç„¶ä¼šçˆ†`TypeErrorï¼šStorage location can only be given for array or struct types.`

![image.png](https://img12.360buyimg.com/ddimg/jfs/t1/224241/30/7652/4175/657704c8F779a1fdd/c0217e1ccadd7a81.jpg)

ä¸èƒ½ä½¿ç”¨`memory`ä¿®é¥°çš„ç±»å‹ï¼š

- `int`, `int256`, `uint256`, ......
- `address`
- `bool`
- `Entry`ï¼ˆç‰¹åˆ«æ³¨æ„ï¼Œä½¿ç”¨tableçš„æ—¶å€™ä¸è¦è¯¯åŠ ï¼‰





### å‡½æ•°



### Table CRUD

#### APIè°ƒç”¨

**æ•°ç»„**æ“ä½œï¼ˆæ–°å»ºï¼Œå®šä½ç´¢å¼•ï¼‰ä½¿ç”¨`uint256`ç±»å‹ï¼Œè€Œ**Table**çš„ç›¸å…³æ“ä½œä¸­ï¼ˆ`entry.get(int256)`ï¼Œ `entries.size()`çš„è¿”å›å€¼ï¼‰çš„æ•´å‹æ˜¯`int256`ç±»å‹ã€‚



Tableä¸èƒ½ç›´æ¥è·å–å…¨éƒ¨



#### è¡¨è®¾è®¡

**Table**è¡¨æ˜¯**å¤šä¸»é”®**çš„ï¼Œè¿™ä¸€ç‚¹ä¸sqlæ˜¯ä¸ä¸€æ ·çš„ã€‚

